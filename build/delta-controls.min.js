/**
 * delta-controls v2.1.0 build Mon Mar 02 2020
 * https://github.com/vanruesc/delta-controls
 * Copyright 2020 Raoul van RÃ¼schen
 * @license Zlib
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("math-ds")):"function"==typeof define&&define.amd?define(["exports","math-ds"],e):e((t=t||self).DELTACONTROLS={},t.MATHDS)}(this,(function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function o(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&a(t,e)}function r(t){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function a(t,e){return(a=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function h(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function u(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var c={MOVE_FORWARD:0,MOVE_LEFT:1,MOVE_BACKWARD:2,MOVE_RIGHT:3,MOVE_DOWN:4,MOVE_UP:5,ZOOM_OUT:6,ZOOM_IN:7},l={MAIN:0,AUXILIARY:1,SECONDARY:2},v=2*Math.PI,d=new e.Vector3,f=new e.Matrix4,g=function(){function t(i,o,s,r){n(this,t),this.position=i,this.quaternion=o,this.target=s,this.settings=r,this.spherical=new e.Spherical}return o(t,[{key:"setPosition",value:function(t){return this.position=t,this}},{key:"setQuaternion",value:function(t){return this.quaternion=t,this}},{key:"setTarget",value:function(t){return this.target=t,this}},{key:"updateQuaternion",value:function(){var t=this.settings,e=t.rotation;return t.general.orbit?f.lookAt(d.subVectors(this.position,this.target),e.pivotOffset,e.up):f.lookAt(d.set(0,0,0),this.target.setFromSpherical(this.spherical),e.up),this.quaternion.setFromRotationMatrix(f),this}},{key:"adjustSpherical",value:function(t,e){var n=this.settings,i=n.general.orbit,o=n.rotation,s=this.spherical;return s.theta=o.invertX?s.theta+t:s.theta-t,s.phi=!i&&!o.invertY||i&&o.invertY?s.phi+e:s.phi-e,s.theta=Math.min(Math.max(s.theta,o.minAzimuthalAngle),o.maxAzimuthalAngle),s.phi=Math.min(Math.max(s.phi,o.minPolarAngle),o.maxPolarAngle),s.theta%=v,s.makeSafe(),i&&this.position.setFromSpherical(s).add(this.target),this}},{key:"zoom",value:function(t){var e,n,i,o=this.settings,s=o.general,r=o.sensitivity,a=o.zoom,h=this.spherical;return s.orbit&&a.enabled&&(e=t*r.zoom,a.invert&&(e=-e),n=Math.max(a.minDistance,1e-6),i=Math.min(a.maxDistance,1/0),h.radius=Math.min(Math.max(h.radius+e,n),i),this.position.setFromSpherical(h).add(this.target)),this}},{key:"update",value:function(t){}},{key:"lookAt",value:function(t){var e=this.spherical,n=this.position,i=this.target;return i.copy(t),this.settings.general.orbit?d.subVectors(n,i):d.subVectors(i,n).normalize(),e.setFromVector3(d),e.radius=Math.max(e.radius,1e-6),this.updateQuaternion(),this}},{key:"getViewDirection",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new e.Vector3;return t.setFromSpherical(this.spherical).normalize(),this.settings.general.orbit&&t.negate(),t}}]),t}(),y=function(){function t(){n(this,t),this.left=!1,this.right=!1,this.forward=!1,this.backward=!1,this.up=!1,this.down=!1}return o(t,[{key:"reset",value:function(){return this.left=!1,this.right=!1,this.forward=!1,this.backward=!1,this.up=!1,this.down=!1,this}}]),t}(),m=new e.Vector3(1,0,0),p=new e.Vector3(0,1,0),k=new e.Vector3(0,0,1),A=new e.Vector3,E=function(){function t(e,i,o,s){n(this,t),this.position=e,this.quaternion=i,this.target=o,this.settings=s,this.movementState=new y}return o(t,[{key:"setPosition",value:function(t){return this.position=t,this}},{key:"setQuaternion",value:function(t){return this.quaternion=t,this}},{key:"setTarget",value:function(t){return this.target=t,this}},{key:"translateOnAxis",value:function(t,e){A.copy(t).applyQuaternion(this.quaternion).multiplyScalar(e),this.position.add(A),this.settings.general.orbit&&this.target.add(A)}},{key:"translate",value:function(t){var e=this.settings.sensitivity,n=this.movementState,i=t*e.translation;n.backward?this.translateOnAxis(k,i):n.forward&&this.translateOnAxis(k,-i),n.right?this.translateOnAxis(m,i):n.left&&this.translateOnAxis(m,-i),n.up?this.translateOnAxis(p,i):n.down&&this.translateOnAxis(p,-i)}},{key:"update",value:function(t){this.settings.translation.enabled&&this.translate(t)}},{key:"moveTo",value:function(t){return this.settings.general.orbit?this.target.copy(t):this.position.copy(t),this}}]),t}(),M=new Proxy({BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPS_LOCK:20,ESCAPE:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,META_LEFT:91,META_RIGHT:92,SELECT:93,NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,MULTIPLY:106,ADD:107,SUBTRACT:109,DECIMAL_POINT:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUM_LOCK:144,SCROLL_LOCK:145,SEMICOLON:186,EQUAL_SIGN:187,COMMA:188,DASH:189,PERIOD:190,FORWARD_SLASH:191,GRAVE_ACCENT:192,OPEN_BRACKET:219,BACK_SLASH:220,CLOSE_BRACKET:221,SINGLE_QUOTE:222},{get:function(t,e){return e in t?t[e]:1===e.length?e.toUpperCase().charCodeAt(0):void 0}}),O=function(){function t(){n(this,t),this.orbit=!0}return o(t,[{key:"copy",value:function(t){return this.orbit=t.orbit,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),t}(),w=function(){function t(){n(this,t),this.defaultActions=new Map,this.actions=new Map}return o(t,[{key:"reset",value:function(){return this.actions=new Map(this.defaultActions),this}},{key:"setDefault",value:function(t){return this.defaultActions=t,this.reset()}},{key:"copy",value:function(t){return this.defaultActions=new Map(t.defaultActions),this.actions=new Map(t.actions),this}},{key:"clearDefault",value:function(){return this.defaultActions.clear(),this}},{key:"clear",value:function(){return this.actions.clear(),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"has",value:function(t){return this.actions.has(t)}},{key:"get",value:function(t){return this.actions.get(t)}},{key:"set",value:function(t,e){return this.actions.set(t,e),this}},{key:"delete",value:function(t){return this.actions.delete(t)}},{key:"toJSON",value:function(){return{defaultActions:u(this.defaultActions),actions:u(this.actions)}}}]),t}(),b=function(){function t(){n(this,t),this.hold=!1,this.lock=!0}return o(t,[{key:"copy",value:function(t){return this.hold=t.hold,this.lock=t.lock,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),t}(),P=function(){function t(){n(this,t),this.up=new e.Vector3,this.up.copy(p),this.pivotOffset=new e.Vector3,this.minAzimuthalAngle=-1/0,this.maxAzimuthalAngle=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.invertX=!1,this.invertY=!1}return o(t,[{key:"copy",value:function(t){return this.up.copy(t.up),this.pivotOffset.copy(t.pivotOffset),this.minAzimuthalAngle=null!==t.minAzimuthalAngle?t.minAzimuthalAngle:-1/0,this.maxAzimuthalAngle=null!==t.maxAzimuthalAngle?t.maxAzimuthalAngle:1/0,this.minPolarAngle=t.minPolarAngle,this.maxPolarAngle=t.maxPolarAngle,this.invertX=t.invertX,this.invertY=t.invertY,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),t}(),D=function(){function t(){n(this,t),this.rotation=.0025,this.translation=1,this.zoom=.1}return o(t,[{key:"copy",value:function(t){return this.rotation=t.rotation,this.translation=t.translation,this.zoom=t.zoom,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),t}(),L=function(){function t(){n(this,t),this.enabled=!0}return o(t,[{key:"copy",value:function(t){return this.enabled=t.enabled,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),t}(),S=function(){function t(){n(this,t),this.enabled=!0,this.invert=!1,this.minDistance=1e-6,this.maxDistance=1/0}return o(t,[{key:"copy",value:function(t){return this.enabled=t.enabled,this.invert=t.invert,this.minDistance=t.minDistance,this.maxDistance=t.maxDistance,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),t}(),T=function(){function t(){n(this,t),this.general=new O,this.keyBindings=new w,this.keyBindings.setDefault(new Map([[M.W,c.MOVE_FORWARD],[M.UP,c.MOVE_FORWARD],[M.A,c.MOVE_LEFT],[M.LEFT,c.MOVE_LEFT],[M.S,c.MOVE_BACKWARD],[M.DOWN,c.MOVE_BACKWARD],[M.D,c.MOVE_RIGHT],[M.RIGHT,c.MOVE_RIGHT],[M.X,c.MOVE_DOWN],[M.SPACE,c.MOVE_UP],[M.PAGE_DOWN,c.ZOOM_OUT],[M.PAGE_UP,c.ZOOM_IN]])),this.pointer=new b,this.rotation=new P,this.sensitivity=new D,this.translation=new L,this.zoom=new S}return o(t,[{key:"copy",value:function(t){return this.general.copy(t.general),this.keyBindings.copy(t.keyBindings),this.pointer.copy(t.pointer),this.rotation.copy(t.rotation),this.sensitivity.copy(t.sensitivity),this.translation.copy(t.translation),this.zoom.copy(t.zoom),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"toDataURL",value:function(){return URL.createObjectURL(new Blob([JSON.stringify(this)],{type:"text/json"}))}}]),t}(),_=function(){function t(){n(this,t)}return o(t,[{key:"execute",value:function(t){throw new Error("Strategy#execute method not implemented!")}}]),t}(),R=function(t){function e(t,i){var o;return n(this,e),(o=h(this,r(e).call(this))).movementState=t,o.direction=i,o}return s(e,t),o(e,[{key:"execute",value:function(t){var e=this.movementState;switch(this.direction){case x.FORWARD:e.forward=t;break;case x.LEFT:e.left=t;break;case x.BACKWARD:e.backward=t;break;case x.RIGHT:e.right=t;break;case x.DOWN:e.down=t;break;case x.UP:e.up=t}}}]),e}(_),x={FORWARD:0,LEFT:1,BACKWARD:2,RIGHT:3,DOWN:4,UP:5},V=function(t){function e(t,i){var o;return n(this,e),(o=h(this,r(e).call(this))).rotationManager=t,o.zoomIn=i,o}return s(e,t),o(e,[{key:"execute",value:function(t){t&&this.rotationManager.zoom(this.zoomIn?-1:1)}}]),e}(_),N=function(){function t(){var i,o,s,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:document.body;n(this,t),this.dom=h,this.position=r,this.quaternion=a,this.target=new e.Vector3,this.settings=new T,this.rotationManager=new g(r,a,this.target,this.settings),this.translationManager=new E(r,a,this.target,this.settings),this.strategies=(i=this.rotationManager,o=this.translationManager,s=o.movementState,new Map([[c.MOVE_FORWARD,new R(s,x.FORWARD)],[c.MOVE_LEFT,new R(s,x.LEFT)],[c.MOVE_BACKWARD,new R(s,x.BACKWARD)],[c.MOVE_RIGHT,new R(s,x.RIGHT)],[c.MOVE_DOWN,new R(s,x.DOWN)],[c.MOVE_UP,new R(s,x.UP)],[c.ZOOM_OUT,new V(i,!1)],[c.ZOOM_IN,new V(i,!0)]])),this.lastScreenPosition=new e.Vector2,this.dragging=!1,this.enabled=!1,null!==r&&null!==a&&(this.lookAt(this.target),null!==h&&this.setEnabled())}return o(t,[{key:"getDom",value:function(){return this.dom}},{key:"getPosition",value:function(){return this.position}},{key:"getQuaternion",value:function(){return this.quaternion}},{key:"getTarget",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new e.Vector3;return t.copy(this.target),this.settings.general.orbit||t.add(this.position),t}},{key:"getViewDirection",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new e.Vector3;return this.rotationManager.getViewDirection(t)}},{key:"setDom",value:function(t){var e=this.enabled;return null!==t&&(e&&this.setEnabled(!1),this.dom=t,this.setEnabled(e)),this}},{key:"setPosition",value:function(t){return this.position=t,this.rotationManager.setPosition(t),this.translationManager.setPosition(t),this.lookAt(this.target)}},{key:"setQuaternion",value:function(t){return this.quaternion=t,this.rotationManager.setQuaternion(t),this.translationManager.setQuaternion(t),this.lookAt(this.target)}},{key:"setTarget",value:function(t){return this.target=t,this.rotationManager.setTarget(t),this.translationManager.setTarget(t),this.lookAt(this.target)}},{key:"setOrbitEnabled",value:function(t){var e=this.settings.general;return e.orbit!==t&&(this.getTarget(this.target),e.orbit=t,this.lookAt(this.target)),this}},{key:"copy",value:function(t){return this.dom=t.getDom(),this.position=t.getPosition(),this.quaternion=t.getQuaternion(),this.target=t.getTarget(),this.settings.copy(t.settings),this.rotationManager.setPosition(this.position).setQuaternion(this.quaternion).setTarget(this.target),this.translationManager.setPosition(this.position).setQuaternion(this.quaternion).setTarget(this.target),this.lookAt(this.target)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"handlePointerMoveEvent",value:function(t){var e,n,i=this.settings,o=i.pointer,s=i.sensitivity,r=this.rotationManager,a=this.lastScreenPosition;document.pointerLockElement===this.dom?o.hold&&!this.dragging||r.adjustSpherical(t.movementX*s.rotation,t.movementY*s.rotation).updateQuaternion():(e=t.screenX-a.x,n=t.screenY-a.y,a.set(t.screenX,t.screenY),r.adjustSpherical(e*s.rotation,n*s.rotation).updateQuaternion())}},{key:"handleTouchMoveEvent",value:function(t){var e=this.settings.sensitivity,n=this.rotationManager,i=this.lastScreenPosition,o=t.touches[0],s=o.screenX-i.x,r=o.screenY-i.y;i.set(o.screenX,o.screenY),t.preventDefault(),n.adjustSpherical(s*e.rotation,r*e.rotation).updateQuaternion()}},{key:"handleMainPointerButton",value:function(t,e){this.dragging=e,this.settings.pointer.lock?this.setPointerLocked():e?(this.lastScreenPosition.set(t.screenX,t.screenY),this.dom.addEventListener("mousemove",this)):this.dom.removeEventListener("mousemove",this)}},{key:"handleAuxiliaryPointerButton",value:function(t,e){}},{key:"handleSecondaryPointerButton",value:function(t,e){}},{key:"handlePointerButtonEvent",value:function(t,e){switch(t.preventDefault(),t.button){case l.MAIN:this.handleMainPointerButton(t,e);break;case l.AUXILIARY:this.handleAuxiliaryPointerButton(t,e);break;case l.SECONDARY:this.handleSecondaryPointerButton(t,e)}}},{key:"handleTouchEvent",value:function(t,e){var n=t.touches[0];t.preventDefault(),e?(this.lastScreenPosition.set(n.screenX,n.screenY),this.dom.addEventListener("touchmove",this)):this.dom.removeEventListener("touchmove",this)}},{key:"handleKeyboardEvent",value:function(t,e){var n=this.settings.keyBindings;n.has(t.keyCode)&&(t.preventDefault(),this.strategies.get(n.get(t.keyCode)).execute(e))}},{key:"handleWheelEvent",value:function(t){this.rotationManager.zoom(Math.sign(t.deltaY))}},{key:"handlePointerLockEvent",value:function(){document.pointerLockElement===this.dom?this.dom.addEventListener("mousemove",this):this.dom.removeEventListener("mousemove",this)}},{key:"handleEvent",value:function(t){switch(t.type){case"mousemove":this.handlePointerMoveEvent(t);break;case"touchmove":this.handleTouchMoveEvent(t);break;case"mousedown":this.handlePointerButtonEvent(t,!0);break;case"mouseup":this.handlePointerButtonEvent(t,!1);break;case"touchstart":this.handleTouchEvent(t,!0);break;case"touchend":this.handleTouchEvent(t,!1);break;case"keydown":this.handleKeyboardEvent(t,!0);break;case"keyup":this.handleKeyboardEvent(t,!1);break;case"wheel":this.handleWheelEvent(t);break;case"pointerlockchange":this.handlePointerLockEvent()}}},{key:"update",value:function(t){this.rotationManager.update(t),this.translationManager.update(t)}},{key:"moveTo",value:function(t){return this.rotationManager.moveTo(t),this}},{key:"lookAt",value:function(t){return this.rotationManager.lookAt(t),this}},{key:"setPointerLocked",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];t?document.pointerLockElement!==this.dom&&void 0!==this.dom.requestPointerLock&&this.dom.requestPointerLock():void 0!==document.exitPointerLock&&document.exitPointerLock()}},{key:"setEnabled",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=this.dom;return this.translationManager.movementState.reset(),t&&!this.enabled?(document.addEventListener("pointerlockchange",this),document.body.addEventListener("keyup",this),document.body.addEventListener("keydown",this),e.addEventListener("mousedown",this),e.addEventListener("mouseup",this),e.addEventListener("touchstart",this),e.addEventListener("touchend",this),e.addEventListener("wheel",this)):!t&&this.enabled&&(document.removeEventListener("pointerlockchange",this),document.body.removeEventListener("keyup",this),document.body.removeEventListener("keydown",this),e.removeEventListener("mousedown",this),e.removeEventListener("mouseup",this),e.removeEventListener("touchstart",this),e.removeEventListener("touchend",this),e.removeEventListener("wheel",this),e.removeEventListener("mousemove",this),e.removeEventListener("touchmove",this)),this.setPointerLocked(!1),this.enabled=t,this}},{key:"dispose",value:function(){this.setEnabled(!1)}}]),t}();t.Action=c,t.DeltaControls=N,t.Direction=x,t.GeneralSettings=O,t.KeyBindings=w,t.KeyCode=M,t.MovementState=y,t.MovementStrategy=R,t.PointerButton=l,t.PointerSettings=b,t.RotationManager=g,t.RotationSettings=P,t.SensitivitySettings=D,t.Settings=T,t.Strategy=_,t.TranslationManager=E,t.TranslationSettings=L,t.ZoomSettings=S,t.ZoomStrategy=V,Object.defineProperty(t,"__esModule",{value:!0})}));
