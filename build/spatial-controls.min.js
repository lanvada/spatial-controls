/**
 * spatial-controls v1.0.1 build Tue Aug 18 2020
 * https://github.com/vanruesc/spatial-controls
 * Copyright 2020 Raoul van RÃ¼schen
 * @license Zlib
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("three")):"function"==typeof define&&define.amd?define(["exports","three"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).SPATIALCONTROLS={},t.THREE)}(this,(function(t,e){"use strict";var n,i;(n=t.Action||(t.Action={}))[n.MOVE_FORWARD=0]="MOVE_FORWARD",n[n.MOVE_LEFT=1]="MOVE_LEFT",n[n.MOVE_BACKWARD=2]="MOVE_BACKWARD",n[n.MOVE_RIGHT=3]="MOVE_RIGHT",n[n.MOVE_DOWN=4]="MOVE_DOWN",n[n.MOVE_UP=5]="MOVE_UP",n[n.ZOOM_OUT=6]="ZOOM_OUT",n[n.ZOOM_IN=7]="ZOOM_IN",(i=t.PointerButton||(t.PointerButton={}))[i.MAIN=0]="MAIN",i[i.AUXILIARY=1]="AUXILIARY",i[i.SECONDARY=2]="SECONDARY";var o=function(){this.reset()};o.prototype.reset=function(){return this.left=!1,this.right=!1,this.forward=!1,this.backward=!1,this.up=!1,this.down=!1,this};var s=2*Math.PI,r=new e.Vector3,a=new e.Matrix4,h=function(t,n,i,o){this.position=t,this.quaternion=n,this.target=i,this.settings=o,this.spherical=new e.Spherical};h.prototype.setPosition=function(t){return this.position=t,this},h.prototype.setQuaternion=function(t){return this.quaternion=t,this},h.prototype.setTarget=function(t){return this.target=t,this},h.prototype.updateQuaternion=function(){var t=this.settings,e=t.rotation;return t.general.orbit?a.lookAt(r.subVectors(this.position,this.target),e.pivotOffset,e.up):a.lookAt(r.set(0,0,0),this.target.setFromSpherical(this.spherical),e.up),this.quaternion.setFromRotationMatrix(a),this},h.prototype.adjustSpherical=function(t,e){var n=this.settings,i=n.general.orbit,o=n.rotation,r=this.spherical;return r.theta=o.invertX?r.theta+t:r.theta-t,r.phi=!i&&!o.invertY||i&&o.invertY?r.phi+e:r.phi-e,r.theta=Math.min(Math.max(r.theta,o.minAzimuthalAngle),o.maxAzimuthalAngle),r.phi=Math.min(Math.max(r.phi,o.minPolarAngle),o.maxPolarAngle),r.theta%=s,r.makeSafe(),i&&this.position.setFromSpherical(r).add(this.target),this},h.prototype.zoom=function(t){var e=this.settings,n=e.general,i=e.sensitivity,o=e.zoom,s=this.spherical;if(n.orbit&&o.enabled){var r=t*i.zoom;o.invert&&(r=-r);var a=Math.max(o.minDistance,1e-6),h=Math.min(o.maxDistance,Number.POSITIVE_INFINITY);s.radius=Math.min(Math.max(s.radius+r,a),h),this.position.setFromSpherical(s).add(this.target)}return this},h.prototype.update=function(t){},h.prototype.lookAt=function(t){var e=this.spherical,n=this.position,i=this.target;return i.copy(t),this.settings.general.orbit?r.subVectors(n,i):r.subVectors(i,n).normalize(),e.setFromVector3(r),e.radius=Math.max(e.radius,1e-6),this.updateQuaternion(),this},h.prototype.getViewDirection=function(t){return t.setFromSpherical(this.spherical).normalize(),this.settings.general.orbit&&t.negate(),t};var c,u=new e.Vector3(1,0,0),p=new e.Vector3(0,1,0),l=new e.Vector3(0,0,1),d=new e.Vector3,A=function(t,e,n,i){this.position=t,this.quaternion=e,this.target=n,this.settings=i,this.movementState=new o};A.prototype.setPosition=function(t){return this.position=t,this},A.prototype.setQuaternion=function(t){return this.quaternion=t,this},A.prototype.setTarget=function(t){return this.target=t,this},A.prototype.translateOnAxis=function(t,e){d.copy(t).applyQuaternion(this.quaternion).multiplyScalar(e),this.position.add(d),this.settings.general.orbit&&this.target.add(d)},A.prototype.translate=function(t){var e=this.settings.sensitivity,n=this.movementState,i=t*e.translation;n.backward?this.translateOnAxis(l,i):n.forward&&this.translateOnAxis(l,-i),n.right?this.translateOnAxis(u,i):n.left&&this.translateOnAxis(u,-i),n.up?this.translateOnAxis(p,i):n.down&&this.translateOnAxis(p,-i)},A.prototype.update=function(t){this.settings.translation.enabled&&this.translate(t)},A.prototype.moveTo=function(t){return this.settings.general.orbit?this.target.copy(t):this.position.copy(t),this},(c=t.KeyCode||(t.KeyCode={}))[c.BACKSPACE=8]="BACKSPACE",c[c.TAB=9]="TAB",c[c.ENTER=13]="ENTER",c[c.SHIFT=16]="SHIFT",c[c.CTRL=17]="CTRL",c[c.ALT=18]="ALT",c[c.PAUSE=19]="PAUSE",c[c.CAPS_LOCK=20]="CAPS_LOCK",c[c.ESCAPE=27]="ESCAPE",c[c.SPACE=32]="SPACE",c[c.PAGE_UP=33]="PAGE_UP",c[c.PAGE_DOWN=34]="PAGE_DOWN",c[c.END=35]="END",c[c.HOME=36]="HOME",c[c.LEFT=37]="LEFT",c[c.UP=38]="UP",c[c.RIGHT=39]="RIGHT",c[c.DOWN=40]="DOWN",c[c.INSERT=45]="INSERT",c[c.DELETE=46]="DELETE",c[c.DIGIT_0=48]="DIGIT_0",c[c.DIGIT_1=49]="DIGIT_1",c[c.DIGIT_2=50]="DIGIT_2",c[c.DIGIT_3=51]="DIGIT_3",c[c.DIGIT_4=52]="DIGIT_4",c[c.DIGIT_5=53]="DIGIT_5",c[c.DIGIT_6=54]="DIGIT_6",c[c.DIGIT_7=55]="DIGIT_7",c[c.DIGIT_8=56]="DIGIT_8",c[c.DIGIT_9=57]="DIGIT_9",c[c.A=65]="A",c[c.B=66]="B",c[c.C=67]="C",c[c.D=68]="D",c[c.E=69]="E",c[c.F=70]="F",c[c.G=71]="G",c[c.H=72]="H",c[c.I=73]="I",c[c.J=74]="J",c[c.K=75]="K",c[c.L=76]="L",c[c.M=77]="M",c[c.N=78]="N",c[c.O=79]="O",c[c.P=80]="P",c[c.Q=81]="Q",c[c.R=82]="R",c[c.S=83]="S",c[c.T=84]="T",c[c.U=85]="U",c[c.V=86]="V",c[c.W=87]="W",c[c.X=88]="X",c[c.Y=89]="Y",c[c.Z=90]="Z",c[c.META_LEFT=91]="META_LEFT",c[c.META_RIGHT=92]="META_RIGHT",c[c.SELECT=93]="SELECT",c[c.NUMPAD_0=96]="NUMPAD_0",c[c.NUMPAD_1=97]="NUMPAD_1",c[c.NUMPAD_2=98]="NUMPAD_2",c[c.NUMPAD_3=99]="NUMPAD_3",c[c.NUMPAD_4=100]="NUMPAD_4",c[c.NUMPAD_5=101]="NUMPAD_5",c[c.NUMPAD_6=102]="NUMPAD_6",c[c.NUMPAD_7=103]="NUMPAD_7",c[c.NUMPAD_8=104]="NUMPAD_8",c[c.NUMPAD_9=105]="NUMPAD_9",c[c.MULTIPLY=106]="MULTIPLY",c[c.ADD=107]="ADD",c[c.SUBTRACT=109]="SUBTRACT",c[c.DECIMAL_POINT=110]="DECIMAL_POINT",c[c.DIVIDE=111]="DIVIDE",c[c.F1=112]="F1",c[c.F2=113]="F2",c[c.F3=114]="F3",c[c.F4=115]="F4",c[c.F5=116]="F5",c[c.F6=117]="F6",c[c.F7=118]="F7",c[c.F8=119]="F8",c[c.F9=120]="F9",c[c.F10=121]="F10",c[c.F11=122]="F11",c[c.F12=123]="F12",c[c.NUM_LOCK=144]="NUM_LOCK",c[c.SCROLL_LOCK=145]="SCROLL_LOCK",c[c.SEMICOLON=186]="SEMICOLON",c[c.EQUAL_SIGN=187]="EQUAL_SIGN",c[c.COMMA=188]="COMMA",c[c.DASH=189]="DASH",c[c.PERIOD=190]="PERIOD",c[c.FORWARD_SLASH=191]="FORWARD_SLASH",c[c.GRAVE_ACCENT=192]="GRAVE_ACCENT",c[c.OPEN_BRACKET=219]="OPEN_BRACKET",c[c.BACK_SLASH=220]="BACK_SLASH",c[c.CLOSE_BRACKET=221]="CLOSE_BRACKET",c[c.SINGLE_QUOTE=222]="SINGLE_QUOTE";var E=function(){this.orbit=!0};E.prototype.copy=function(t){return this.orbit=t.orbit,this},E.prototype.clone=function(){var t=new E;return t.copy(this)};var m=function(){this.defaultActions=new Map,this.actions=new Map};m.prototype.reset=function(){return this.actions=new Map(this.defaultActions),this},m.prototype.setDefault=function(t){return this.defaultActions=t,this.reset()},m.prototype.copy=function(t){return this.defaultActions=new Map(t.defaultActions),this.actions=new Map(t.actions),this},m.prototype.clearDefault=function(){return this.defaultActions.clear(),this},m.prototype.clear=function(){return this.actions.clear(),this},m.prototype.clone=function(){var t=new m;return t.copy(this)},m.prototype.has=function(t){return this.actions.has(t)},m.prototype.get=function(t){return this.actions.get(t)},m.prototype.set=function(t,e){return this.actions.set(t,e),this},m.prototype.delete=function(t){return this.actions.delete(t)},m.prototype.toJSON=function(){return{defaultActions:[].concat(this.defaultActions),actions:[].concat(this.actions)}};var y=function(){this.hold=!1,this.lock=!0};y.prototype.copy=function(t){return this.hold=t.hold,this.lock=t.lock,this},y.prototype.clone=function(){var t=new y;return t.copy(this)};var g=function(){this.up=new e.Vector3,this.up.copy(p),this.pivotOffset=new e.Vector3,this.minAzimuthalAngle=Number.NEGATIVE_INFINITY,this.maxAzimuthalAngle=Number.POSITIVE_INFINITY,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.invertX=!1,this.invertY=!1};g.prototype.copy=function(t){return this.up.copy(t.up),this.pivotOffset.copy(t.pivotOffset),this.minAzimuthalAngle=t.minAzimuthalAngle,this.maxAzimuthalAngle=t.maxAzimuthalAngle,this.minPolarAngle=t.minPolarAngle,this.maxPolarAngle=t.maxPolarAngle,this.invertX=t.invertX,this.invertY=t.invertY,this},g.prototype.clone=function(){var t=new g;return t.copy(this)};var v=function(){this.rotationX=1,this.rotationY=1,this.translation=1,this.zoom=1},f={rotation:{configurable:!0}};f.rotation.set=function(t){this.rotationX=this.rotationY=t},v.prototype.copy=function(t){return this.rotationX=t.rotationX,this.rotationY=t.rotationY,this.translation=t.translation,this.zoom=t.zoom,this},v.prototype.clone=function(){var t=new v;return t.copy(this)},Object.defineProperties(v.prototype,f);var M=function(){this.enabled=!0};M.prototype.copy=function(t){return this.enabled=t.enabled,this},M.prototype.clone=function(){var t=new M;return t.copy(this)};var D=function(){this.enabled=!0,this.invert=!1,this.minDistance=1e-6,this.maxDistance=1/0};D.prototype.copy=function(t){return this.enabled=t.enabled,this.invert=t.invert,this.minDistance=t.minDistance,this.maxDistance=t.maxDistance,this},D.prototype.clone=function(){var t=new D;return t.copy(this)};var O=function(){this.general=new E,this.keyBindings=new m,this.keyBindings.setDefault(new Map([[t.KeyCode.W,t.Action.MOVE_FORWARD],[t.KeyCode.UP,t.Action.MOVE_FORWARD],[t.KeyCode.A,t.Action.MOVE_LEFT],[t.KeyCode.LEFT,t.Action.MOVE_LEFT],[t.KeyCode.S,t.Action.MOVE_BACKWARD],[t.KeyCode.DOWN,t.Action.MOVE_BACKWARD],[t.KeyCode.D,t.Action.MOVE_RIGHT],[t.KeyCode.RIGHT,t.Action.MOVE_RIGHT],[t.KeyCode.X,t.Action.MOVE_DOWN],[t.KeyCode.SPACE,t.Action.MOVE_UP],[t.KeyCode.PAGE_DOWN,t.Action.ZOOM_OUT],[t.KeyCode.PAGE_UP,t.Action.ZOOM_IN]])),this.pointer=new y,this.rotation=new g,this.sensitivity=new v,this.translation=new M,this.zoom=new D};O.prototype.copy=function(t){return this.general.copy(t.general),this.keyBindings.copy(t.keyBindings),this.pointer.copy(t.pointer),this.rotation.copy(t.rotation),this.sensitivity.copy(t.sensitivity),this.translation.copy(t.translation),this.zoom.copy(t.zoom),this},O.prototype.clone=function(){var t=new O;return t.copy(this)},O.prototype.toDataURL=function(){return URL.createObjectURL(new Blob([JSON.stringify(this)],{type:"text/json"}))};var T,P=function(t,e){this.movementState=t,this.direction=e};P.prototype.execute=function(e){var n=this.movementState;switch(this.direction){case t.Direction.FORWARD:n.forward=e;break;case t.Direction.LEFT:n.left=e;break;case t.Direction.BACKWARD:n.backward=e;break;case t.Direction.RIGHT:n.right=e;break;case t.Direction.DOWN:n.down=e;break;case t.Direction.UP:n.up=e}},(T=t.Direction||(t.Direction={}))[T.FORWARD=0]="FORWARD",T[T.LEFT=1]="LEFT",T[T.BACKWARD=2]="BACKWARD",T[T.RIGHT=3]="RIGHT",T[T.DOWN=4]="DOWN",T[T.UP=5]="UP";var _=function(t,e){this.rotationManager=t,this.zoomIn=e};_.prototype.execute=function(t){t&&this.rotationManager.zoom(this.zoomIn?-1:1)};var I=function(n,i,o){void 0===n&&(n=null),void 0===i&&(i=null),void 0===o&&(o=document.body),this.domElement=o,this.position=n,this.quaternion=i,this.target=new e.Vector3,this.settings=new O,this.rotationManager=new h(n,i,this.target,this.settings),this.translationManager=new A(n,i,this.target,this.settings);var s=this.translationManager.movementState;this.strategies=new Map([[t.Action.MOVE_FORWARD,new P(s,t.Direction.FORWARD)],[t.Action.MOVE_LEFT,new P(s,t.Direction.LEFT)],[t.Action.MOVE_BACKWARD,new P(s,t.Direction.BACKWARD)],[t.Action.MOVE_RIGHT,new P(s,t.Direction.RIGHT)],[t.Action.MOVE_DOWN,new P(s,t.Direction.DOWN)],[t.Action.MOVE_UP,new P(s,t.Direction.UP)],[t.Action.ZOOM_OUT,new _(this.rotationManager,!1)],[t.Action.ZOOM_IN,new _(this.rotationManager,!0)]]),this.lastScreenPosition=new e.Vector2,this.dragging=!1,this.enabled=!1,null!==n&&null!==i&&(this.lookAt(this.target),null!==o&&this.setEnabled())};I.prototype.getDomElement=function(){return this.domElement},I.prototype.setDomElement=function(t){var e=this.enabled;return null!==t&&(e&&this.setEnabled(!1),this.domElement=t,this.setEnabled(e)),this},I.prototype.getPosition=function(){return this.position},I.prototype.setPosition=function(t){return this.position=t,this.rotationManager.setPosition(t),this.translationManager.setPosition(t),this.lookAt(this.target)},I.prototype.getQuaternion=function(){return this.quaternion},I.prototype.setQuaternion=function(t){return this.quaternion=t,this.rotationManager.setQuaternion(t),this.translationManager.setQuaternion(t),this.lookAt(this.target)},I.prototype.getTarget=function(t){return t.copy(this.target),this.settings.general.orbit||t.add(this.position),t},I.prototype.setTarget=function(t){return this.target=t,this.rotationManager.setTarget(t),this.translationManager.setTarget(t),this.lookAt(this.target)},I.prototype.getViewDirection=function(t){return this.rotationManager.getViewDirection(t)},I.prototype.setOrbitEnabled=function(t){var e=this.settings.general;return e.orbit!==t&&(this.getTarget(this.target),e.orbit=t,this.lookAt(this.target)),this},I.prototype.copy=function(t){return this.domElement=t.getDomElement(),this.position=t.getPosition(),this.quaternion=t.getQuaternion(),this.target=t.getTarget(new e.Vector3),this.settings.copy(t.settings),this.rotationManager.setPosition(this.position).setQuaternion(this.quaternion).setTarget(this.target),this.translationManager.setPosition(this.position).setQuaternion(this.quaternion).setTarget(this.target),this.lookAt(this.target)},I.prototype.clone=function(){var t=new I;return t.copy(this)},I.prototype.handlePointerMoveEvent=function(t){var e=this.settings,n=e.pointer,i=e.sensitivity,o=this.rotationManager,s=this.lastScreenPosition;if(document.pointerLockElement===this.domElement)n.hold&&!this.dragging||o.adjustSpherical(.001*t.movementX*i.rotationX,.001*t.movementY*i.rotationY).updateQuaternion();else{var r=t.screenX-s.x,a=t.screenY-s.y;s.set(t.screenX,t.screenY),o.adjustSpherical(.001*r*i.rotationX,.001*a*i.rotationY).updateQuaternion()}},I.prototype.handleTouchMoveEvent=function(t){var e=this.settings.sensitivity,n=this.rotationManager,i=this.lastScreenPosition,o=t.touches[0],s=o.screenX-i.x,r=o.screenY-i.y;i.set(o.screenX,o.screenY),t.preventDefault(),n.adjustSpherical(.001*s*e.rotationX,.001*r*e.rotationY).updateQuaternion()},I.prototype.handleMainPointerButton=function(t,e){this.dragging=e,this.settings.pointer.lock?this.setPointerLocked():e?(this.lastScreenPosition.set(t.screenX,t.screenY),this.domElement.addEventListener("mousemove",this)):this.domElement.removeEventListener("mousemove",this)},I.prototype.handleAuxiliaryPointerButton=function(t,e){},I.prototype.handleSecondaryPointerButton=function(t,e){},I.prototype.handlePointerButtonEvent=function(e,n){switch(e.preventDefault(),e.button){case t.PointerButton.MAIN:this.handleMainPointerButton(e,n);break;case t.PointerButton.AUXILIARY:this.handleAuxiliaryPointerButton(e,n);break;case t.PointerButton.SECONDARY:this.handleSecondaryPointerButton(e,n)}},I.prototype.handleTouchEvent=function(t,e){var n=t.touches[0];t.preventDefault(),e?(this.lastScreenPosition.set(n.screenX,n.screenY),this.domElement.addEventListener("touchmove",this)):this.domElement.removeEventListener("touchmove",this)},I.prototype.handleKeyboardEvent=function(t,e){var n=this.settings.keyBindings;n.has(t.keyCode)&&(t.preventDefault(),this.strategies.get(n.get(t.keyCode)).execute(e))},I.prototype.handleWheelEvent=function(t){this.rotationManager.zoom(Math.sign(t.deltaY))},I.prototype.handlePointerLockEvent=function(){document.pointerLockElement===this.domElement?this.domElement.addEventListener("mousemove",this):this.domElement.removeEventListener("mousemove",this)},I.prototype.handleEvent=function(t){switch(t.type){case"mousemove":this.handlePointerMoveEvent(t);break;case"touchmove":this.handleTouchMoveEvent(t);break;case"mousedown":this.handlePointerButtonEvent(t,!0);break;case"mouseup":this.handlePointerButtonEvent(t,!1);break;case"touchstart":this.handleTouchEvent(t,!0);break;case"touchend":this.handleTouchEvent(t,!1);break;case"keydown":this.handleKeyboardEvent(t,!0);break;case"keyup":this.handleKeyboardEvent(t,!1);break;case"wheel":this.handleWheelEvent(t);break;case"pointerlockchange":this.handlePointerLockEvent()}},I.prototype.update=function(t){this.rotationManager.update(t),this.translationManager.update(t)},I.prototype.moveTo=function(t){return this.translationManager.moveTo(t),this},I.prototype.lookAt=function(t){return this.rotationManager.lookAt(t),this},I.prototype.setPointerLocked=function(t){void 0===t&&(t=!0),t?document.pointerLockElement!==this.domElement&&void 0!==this.domElement.requestPointerLock&&this.domElement.requestPointerLock():void 0!==document.exitPointerLock&&document.exitPointerLock()},I.prototype.setEnabled=function(t){void 0===t&&(t=!0);var e=this.domElement;return this.translationManager.movementState.reset(),t&&!this.enabled?(document.addEventListener("pointerlockchange",this),document.body.addEventListener("keyup",this),document.body.addEventListener("keydown",this),e.addEventListener("mousedown",this),e.addEventListener("mouseup",this),e.addEventListener("touchstart",this),e.addEventListener("touchend",this),e.addEventListener("wheel",this)):!t&&this.enabled&&(document.removeEventListener("pointerlockchange",this),document.body.removeEventListener("keyup",this),document.body.removeEventListener("keydown",this),e.removeEventListener("mousedown",this),e.removeEventListener("mouseup",this),e.removeEventListener("touchstart",this),e.removeEventListener("touchend",this),e.removeEventListener("wheel",this),e.removeEventListener("mousemove",this),e.removeEventListener("touchmove",this)),this.setPointerLocked(!1),this.enabled=t,this},I.prototype.dispose=function(){this.setEnabled(!1)},t.GeneralSettings=E,t.KeyBindings=m,t.MovementState=o,t.MovementStrategy=P,t.PointerSettings=y,t.RotationManager=h,t.RotationSettings=g,t.SensitivitySettings=v,t.Settings=O,t.SpatialControls=I,t.TranslationManager=A,t.TranslationSettings=M,t.ZoomSettings=D,t.ZoomStrategy=_,Object.defineProperty(t,"__esModule",{value:!0})}));
